<!-- src/app/pages/profile/profile.component.html -->
<mat-card *ngIf="user() as u" class="profile-card">
  <!-- Header -->
  <div class="header">
    <img [src]="avatarUrl()" (error)="onAvatarError($event)" alt="avatar"
      class="avatar rounded-circle border-2 border-white bg-light" />
    <div class="meta">
      <h2 class="fullname">{{ u.firstName }} {{ u.lastName }}</h2>
      <div class="row-ids">
        <span class="username">{{ '@' + (u.username || 'user') }}</span>
        <!-- <span class="chip state" [class.inactive]="u.enabled === false">
          {{ u.enabled === false ? 'NOT_ACTIVE' : 'ACTIVE' }}
        </span>
        <span *ngIf="u.status" class="chip status">{{ u.status }}</span> -->
      </div>
    </div>

    <div class="actions">
      <button mat-stroked-button color="primary" (click)="openResetPassword()" [disabled]="!u?.id">
        Đổi mật khẩu
      </button>
      <button mat-flat-button color="accent" class="ml8" (click)="goToEditProfile()">
        Chỉnh sửa hồ sơ
      </button>
    </div>
  </div>

  <!-- One-tab, two-column layout -->
  <div class="pad">
    <div class="row g-3">
      <!-- Cột trái: Thông tin cá nhân -->
      <div class="col-12 col-lg-6">
        <div class="section">
          <div class="section-title">Thông tin</div>
          <table class="info-table">
            <tr>
              <td class="label">Mã giảng viên</td>
              <td class="value">{{ u.teacherCode || '—' }}</td>
            </tr>
            <tr>
              <td class="label">Email</td>
              <td class="value">{{ u.email || '—' }}</td>
            </tr>
            <tr>
              <td class="label">Điện thoại</td>
              <td class="value">{{ u.phone || '—' }}</td>
            </tr>
            <tr>
              <td class="label">Giới tính</td>
              <td class="value">{{ u.gender || '—' }}</td>
            </tr>
            <tr>
              <td class="label">Ngày sinh</td>
              <td class="value">{{ u.birthDate | date:'dd/MM/yyyy' }}</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Cột phải: Quyền, Khoa, Môn đang dạy -->
      <div class="col-12 col-lg-6">
        <!-- Vai trò -->
        <div class="section">
          <div class="section-title">Vai trò</div>
          <div class="chip-row">
            <span *ngFor="let r of roles" class="chip role">{{ r }}</span>
            <span *ngIf="roles.length === 0" class="muted">—</span>
          </div>
        </div>

        <!-- Khoa/Bộ môn -->
        <div class="section">
          <div class="section-title">Khoa/Bộ môn</div>
          <div>
            <span *ngIf="departmentName(); else emptyDept">
              {{ departmentName() }}
            </span>
            <ng-template #emptyDept>
              <span class="muted">Chưa xác định (chưa có môn giảng dạy hoặc BE chưa trả tên khoa).</span>
            </ng-template>
          </div>
        </div>

        <!-- Môn đang giảng dạy -->
        <div class="section">
          <div class="section-title">Môn đang giảng dạy</div>

          <ng-container *ngIf="!loadingSubjects(); else loadingTpl">
            <ng-container *ngIf="subjects().length > 0; else emptySubjects">
              <mat-list>
                <mat-list-item *ngFor="let s of subjects(); trackBy: trackById"
                  [routerLink]="['/user-dashboard/subjects', s.id]" class="subject-item">
                  <div matListItemTitle>{{ s.name }}</div>
                  <div matListItemLine class="muted">
                    Mã: {{ s.code }} • Khoa: {{ s.department?.name || '—' }}
                  </div>
                  <mat-icon matListItemMeta>chevron_right</mat-icon>
                </mat-list-item>
              </mat-list>
            </ng-container>
          </ng-container>

          <ng-template #loadingTpl>
            <div class="muted">Đang tải danh sách môn…</div>
          </ng-template>

          <ng-template #emptySubjects>
            <div class="muted">Chưa có môn giảng dạy hoặc bạn chưa được phân công.</div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

</mat-card>