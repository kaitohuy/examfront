<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="mx-3 my-3">Quản lý Khoa (Bộ môn)</h1>
  <button class="btn btn-primary" (click)="openCreateDialog()" [disabled]="isLoading">
    <i class="bi bi-plus-circle me-1"></i> Thêm Khoa (Bộ môn)
  </button>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="input-group">
      <span class="input-group-text bg-white border-end-0">
        <i class="bi bi-search"></i>
      </span>
      <input
        type="text"
        class="form-control border-start-0"
        placeholder="Tìm kiếm Khoa (Bộ môn)..."
        [(ngModel)]="searchText"
        [disabled]="isLoading">
    </div>
  </div>
</div>

<div class="card shadow-sm position-relative">
  <div class="card-body">

    <!-- (Giữ logic empty/list như cũ, overlay toàn màn hình sẽ chặn thao tác) -->
    <div *ngIf="!isLoading && filteredDepartments.length === 0" class="text-center py-5">
      <i class="bi bi-building text-muted" style="font-size: 3rem;"></i>
      <h4 class="mt-3">Không tìm thấy Khoa (Bộ môn) nào</h4>
      <p class="text-muted">Hãy thử thay đổi từ khóa tìm kiếm hoặc thêm Khoa (Bộ môn) mới</p>
    </div>

    <div *ngIf="!isLoading && filteredDepartments.length > 0" class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th (click)="sort('id')" style="cursor: pointer;">
              ID
              <i class="{{ sortIcons['id'] }} ms-1"></i>
            </th>
            <th (click)="sort('name')" style="cursor: pointer;">
              Tên Khoa (Bộ môn)
              <i class="{{ sortIcons['name'] }} ms-1"></i>
            </th>
            <th (click)="sort('description')" style="cursor: pointer;">
              Mô tả
              <i class="{{ sortIcons['description'] }} ms-1"></i>
            </th>
            <th (click)="sort('headUser')" style="cursor: pointer;">
              Trưởng Khoa (Bộ môn)
              <i class="{{ sortIcons['headUser'] }} ms-1"></i>
            </th>
            <th class="text-end">Hành động</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let dept of filteredDepartments"
              [routerLink]="['/admin-dashboard/department', dept.id, 'subjects']"
              style="cursor: pointer;">
            <td>{{ dept.id }}</td>
            <td>{{ dept.name }}</td>
            <td>{{ dept.description || '--' }}</td>
            <td>
              <div *ngIf="dept.headUser; else noHead">
                {{ dept.headUser.firstName }} {{ dept.headUser.lastName }}
                <span class="badge bg-info ms-2">ID: {{ dept.headUser.id }}</span>
              </div>
              <ng-template #noHead><span class="text-muted">Chưa có</span></ng-template>
            </td>
            <td class="text-end">
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-primary me-2"
                        (click)="openEditDialog(dept); $event.stopPropagation()"
                        [disabled]="isLoading">
                  <i class="bi bi-pencil"></i> Sửa
                </button>
                <button class="btn btn-sm btn-outline-danger"
                        (click)="deleteDepartment(dept.id); $event.stopPropagation()"
                        [disabled]="isLoading">
                  <i class="bi bi-trash"></i> Xóa
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

  <app-loading-screen *ngIf="isLoading"></app-loading-screen>
</div>
