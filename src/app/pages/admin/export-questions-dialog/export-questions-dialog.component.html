<h2 class="m-3" mat-dialog-title>Xuất file các câu hỏi đã chọn <small class="text-muted">({{data.selectedCount}} câu hỏi)</small>
</h2>

<mat-dialog-content class="content pt-2">
  <div class="row g-3 align-items-end mb-2">
    <div class="col-12 col-md-3">
      <label class="form-label">Loại</label>
      <select class="form-select" [(ngModel)]="variant" (change)="onVariantChange()">
        <option value="practice">Ôn tập</option>
        <option value="exam">Đề thi</option>
      </select>
    </div>

    <div class="col-12 col-md-6">
      <label class="form-label">Tên file</label>
      <div class="input-group">
        <input class="form-control" [placeholder]="variant==='practice' ? 'on-tap' : 'de-thi'" [(ngModel)]="fileName">
        <button class="btn btn-outline-secondary" type="button" *ngIf="fileName" (click)="clearFileName()"
          aria-label="Xoá tên file">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
    </div>

    <div class="col-12 col-md-3">
      <label class="form-label">Định dạng</label>
      <select class="form-select" [(ngModel)]="format">
        <option value="pdf">PDF</option>
        <option value="docx">Word (.docx)</option>
      </select>
    </div>
  </div>

  <div *ngIf="variant==='practice'" class="mt-3">
    <div class="border rounded p-3">
      <div class="fw-semibold mb-3"><i class="bi bi-sliders"></i> Tuỳ chọn cho ôn tập</div>
      <div class="row g-3">
        <div class="col-12 col-md-6">
          <label class="form-label">Kiểu Câu hỏi</label>
          <select class="form-select" [(ngModel)]="form">
            <option value="TRAC_NGHIEM">TRẮC NGHIỆM</option>
            <option value="TU_LUAN">TỰ LUẬN</option>
          </select>
        </div>
        <div class="col-12 col-md-6">
          <label class="form-label">Chương trình đào tạo</label>
          <select class="form-select" [(ngModel)]="level">
            <option value="Đại học chính quy">Đại học chính quy</option>
            <option value="Đại học từ xa">Đại học từ xa</option>
            <option value="Vừa học vừa làm">Vừa học vừa làm</option>
            <option value="Cao đẳng chính quy">Cao đẳng chính quy</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="variant==='exam'" class="mt-3">
    <div class="border rounded p-3">
      <div class="fw-semibold mb-3"><i class="bi bi-sliders"></i> Header đề thi</div>
      <div class="row g-3">
        <div class="col-12 col-md-3">
          <label class="form-label">Học kỳ</label>
          <select class="form-select" [(ngModel)]="semester" (ngModelChange)="onSemesterChange()">
            <option value="">(bỏ trống)</option>
            <option value="I">I</option>
            <option value="II">II</option>
            <option value="Hè">Hè</option>
          </select>
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label">Năm học</label>
          <input class="form-control" placeholder="2024-2025" [(ngModel)]="academicYear">
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label">Lớp <span class="text-danger">*</span></label>
          <input name="classes" class="form-control" placeholder="D18CN, D18AT" [(ngModel)]="classes"
            [class.is-invalid]="submitted && variant==='exam' && !classes.trim()" />
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label">Thời lượng (phút)</label>
          <input class="form-control" type="number" min="1" [(ngModel)]="durationMinutes">
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-12 col-md-3">
          <label class="form-label">Bộ môn <span class="text-danger">*</span></label>
          <input name="faculty" class="form-control" placeholder="Công nghệ thông tin" [(ngModel)]="program"
            [class.is-invalid]="submitted && variant==='exam' && !program.trim()" />
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label">Mã đề</label>
          <input class="form-control" type="number" min="1" [(ngModel)]="paperNo">
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label">Hình thức thi</label>
          <select class="form-select" [(ngModel)]="examForm">
            <option value="viết">Viết</option>
            <option value="trắc nghiệm">Trắc nghiệm</option>
          </select>
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label">Mẫu</label>
          <input class="form-control" placeholder="3a" [(ngModel)]="mau">
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex flex-wrap align-items-center gap-4 mt-3">
    <div class="form-check">
      <input id="incAns" class="form-check-input item-checkbox" type="checkbox" [(ngModel)]="includeAnswers">
      <label for="incAns" class="form-check-label">Bao gồm đáp án</label>
    </div>

    <div class="form-check">
      <input id="saveCopy" class="form-check-input item-checkbox" type="checkbox" [(ngModel)]="saveCopy">
      <label for="saveCopy" class="form-check-label">Lưu vào kho lưu trữ</label>
    </div>
  </div>

  <div *ngIf="variant==='exam' && submitted" class="small text-danger mt-1">
    <ng-container *ngIf="!classes?.trim()">• Vui lòng nhập <b>Lớp</b>.</ng-container>
    <ng-container *ngIf="!program?.trim()"> • Vui lòng nhập <b>Bộ môn</b>.</ng-container>
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button type="button" mat-stroked-button (click)="onCancel()">Hủy</button>
  <button type="button" mat-flat-button color="primary" (click)="submit()">
    <mat-icon>download</mat-icon>
    <span class="ms-1">Xuất file</span>
  </button>
</mat-dialog-actions>