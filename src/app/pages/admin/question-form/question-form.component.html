<form [formGroup]="form" class="w-100">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-3 mb-3">

        <div class="meta-grid">

            <mat-form-field appearance="outline" class="mf-compact">
                <mat-label>Mã loại câu</mat-label>
                <input matInput formControlName="typeCode" placeholder="VD: 1.1">
            </mat-form-field>

            <mat-form-field appearance="outline" class="mf-compact">
                <mat-label>Tính chất</mat-label>
                <mat-select formControlName="itemNature">
                    <mat-option [value]="null">-- Không --</mat-option>
                    <mat-option *ngFor="let opt of natureOptions" [value]="opt.value">
                        {{ opt.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="mf-compact">
                <mat-label>Loại câu hỏi</mat-label>
                <mat-select formControlName="questionType">
                    <mat-option *ngFor="let t of questionTypes" [value]="t.value">{{ t.label }}</mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="mf-compact">
                <mat-label>Số điểm</mat-label>
                <mat-select formControlName="difficulty">
                    <mat-option *ngFor="let opt of diffOptions" [value]="opt.value">{{ opt.label }}</mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="mf-compact">
                <mat-label>Chương</mat-label>
                <mat-select formControlName="chapter">
                    <mat-option *ngFor="let c of chapters" [value]="c">{{ c }}</mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="mf-compact" style="grid-column: span 1;">
                <mat-label>Nhãn</mat-label>
                <mat-select formControlName="labels" multiple>
                    <mat-option *ngFor="let opt of labelOptions" [value]="opt.value">{{ opt.label }}</mat-option>
                </mat-select>
            </mat-form-field>

        </div>


    </div>
    <div class="mb-2">
        <app-tool-math [dense]="true" [label]="'Chèn công thức'" [roundedIcon]="true"
            (insert)="insertToFocused($event.tpl, $event.inline)">
        </app-tool-math>
    </div>
    <mat-form-field appearance="outline" class="w-100 mt-2">
        <mat-label>Nội dung câu hỏi (TeX)</mat-label>
        <textarea id="tex-content" matInput rows="4" formControlName="content" (focus)="setFocus('content')"
            placeholder="Ví dụ: Giải phương trình $x^2 - 4 = 0$"></textarea>
        <mat-error *ngIf="form.get('content')?.hasError('required')">Bắt buộc</mat-error>
    </mat-form-field>

    <div class="preview mb-3" [appMathjax]="form.value.content || ''"></div>

    <div *ngIf="isMultiple" class="ans-grid">

        <div class="ans-col">
            <div>
                <mat-form-field appearance="outline" class="w-100 mf-compact">
                    <mat-label>Lựa chọn A</mat-label>
                    <input id="tex-optionA" matInput formControlName="optionA" (focus)="setFocus('optionA')">
                </mat-form-field>
                <div class="preview mt-1" [appMathjax]="form.value.optionA || ''"></div>
            </div>

            <div>
                <mat-form-field appearance="outline" class="w-100 mf-compact">
                    <mat-label>Lựa chọn C</mat-label>
                    <input id="tex-optionC" matInput formControlName="optionC" (focus)="setFocus('optionC')">
                </mat-form-field>
                <div class="preview mt-1" [appMathjax]="form.value.optionC || ''"></div>
            </div>
        </div>

        <div class="ans-col">
            <div>
                <mat-form-field appearance="outline" class="w-100 mf-compact">
                    <mat-label>Lựa chọn B</mat-label>
                    <input id="tex-optionB" matInput formControlName="optionB" (focus)="setFocus('optionB')">
                </mat-form-field>
                <div class="preview mt-1" [appMathjax]="form.value.optionB || ''"></div>
            </div>

            <div>
                <mat-form-field appearance="outline" class="w-100 mf-compact">
                    <mat-label>Lựa chọn D</mat-label>
                    <input id="tex-optionD" matInput formControlName="optionD" (focus)="setFocus('optionD')">
                </mat-form-field>
                <div class="preview mt-1" [appMathjax]="form.value.optionD || ''"></div>
            </div>
        </div>
    </div>

    <div *ngIf="isMultiple" class="mt-3">
        <mat-form-field appearance="outline" class="w-100 mf-compact">
            <mat-label>Đáp án đúng (A, B, C hoặc D)</mat-label>
            <input id="tex-answer" matInput formControlName="answer" maxlength="1" placeholder="A"
                (focus)="setFocus('answer')" style="text-transform: uppercase;">
            <mat-error *ngIf="form.get('answer')?.hasError('required')">Bắt buộc</mat-error>
            <mat-error *ngIf="form.get('answer')?.hasError('pattern')">Chỉ nhập A, B, C hoặc D</mat-error>
        </mat-form-field>
    </div>

    <div *ngIf="!isMultiple" class="mt-3">
        <mat-form-field appearance="outline" class="w-100">
            <mat-label>Lời giải chi tiết / Đáp án</mat-label>
            <textarea id="tex-answerText" matInput rows="3" formControlName="answerText"
                (focus)="setFocus('answerText')"></textarea>
        </mat-form-field>
        <div class="preview" [appMathjax]="form.value.answerText || ''"></div>
    </div>

</form>