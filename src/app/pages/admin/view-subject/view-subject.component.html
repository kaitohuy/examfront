<div class="d-flex justify-content-between align-items-center mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <button class="btn btn-outline-secondary me-3" [routerLink]="['/admin-dashboard/department']">
      <i class="bi bi-arrow-left me-1"></i> Quay lại
    </button>
    <div>
      <h2 class="d-inline-block mb-0" style="font-weight: 250;">Danh Sách Học Phần</h2>
      <h2 class="d-inline-block mb-0" style="margin-left: 5em; font-weight: 250;">Bộ môn: {{ department.name }}</h2>
    </div>
  </div>

  <button class="btn btn-primary" (click)="openCreateDialog()" [disabled]="isLoading">
    <i class="bi bi-plus-circle me-1"></i> Thêm Môn học
  </button>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="input-group">
      <span class="input-group-text bg-white border-end-0">
        <i class="bi bi-search"></i>
      </span>
      <input type="text" class="form-control border-start-0" placeholder="Tìm kiếm môn học..." [(ngModel)]="searchText"
        [disabled]="isLoading">
    </div>
  </div>
</div>

<div class="card shadow-sm position-relative">
  <div class="card-body">
    <!-- Empty -->
    <div *ngIf="!isLoading && subjects.length === 0" class="text-center py-5">
      <i class="bi bi-book text-muted" style="font-size: 3rem;"></i>
      <h4 class="mt-3">Chưa có môn học nào</h4>
      <p class="text-muted">Hãy thêm môn học mới cho bộ môn này</p>
    </div>

    <!-- Table -->
    <div *ngIf="!isLoading && subjects.length > 0" class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th (click)="sort('id')" style="cursor: pointer;">
              ID
              <i class="{{ sortIcons['id'] }} ms-1"></i>
            </th>
            <th (click)="sort('name')" style="cursor: pointer;">
              Tên môn học
              <i class="{{ sortIcons['name'] }} ms-1"></i>
            </th>
            <th (click)="sort('code')" style="cursor: pointer;">
              Mã môn học
              <i class="{{ sortIcons['code'] }} ms-1"></i>
            </th>
            <th>Giảng viên</th>
            <th class="text-end">Hành động</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let subject of filteredSubjects"
            [routerLink]="['/admin-dashboard/department', departmentId, 'subjects', subject.id]"
            style="cursor: pointer;">
            <td>{{ subject.id }}</td>
            <td>{{ subject.name }}</td>
            <td>{{ subject.code }}</td>
            <td>
              <div *ngIf="subject.teachers && subject.teachers.length > 0; else noTeachers">
                <span class="badge bg-info me-1" *ngFor="let teacher of subject.teachers">
                  {{ teacher.lastName }} {{ teacher.firstName }}
                </span>
              </div>
              <ng-template #noTeachers>
                <span class="text-muted">Chưa phân công</span>
              </ng-template>
            </td>
            <td class="text-end">
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-primary me-2" (click)="openEditDialog(subject, $event)"
                  [disabled]="isLoading">
                  <i class="bi bi-pencil"></i> Sửa
                </button>

                <button class="btn btn-sm btn-outline-success me-2" (click)="openManageTeachersDialog(subject, $event)"
                  [disabled]="isLoading">
                  <i class="bi bi-people"></i> Giảng viên
                </button>
                
                <button class="btn btn-sm btn-outline-secondary me-2" (click)="openSettingDialog(subject, $event)"
                  [disabled]="isLoading" matTooltip="Cấu hình đề tự động">
                  <i class="bi bi-gear"></i> Setting
                </button>
                
                <button class="btn btn-sm btn-outline-danger"
                  (click)="deleteSubject(subject.id); $event.stopPropagation()" [disabled]="isLoading">
                  <i class="bi bi-trash"></i> Xóa
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

  <!-- Overlay Loading mới (không làm mờ nền) -->
  <app-loading-screen *ngIf="isLoading" [blurBackground]="false"></app-loading-screen>
</div>