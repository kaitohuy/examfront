<h2 mat-dialog-title>Xem tr∆∞·ªõc k·∫øt qu·∫£ t·∫£i c√¢u h·ªèi l√™n</h2>

<div class="px-2 pb-2 text-sm text-muted">
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
    <div>
      <!-- <b>Session:</b> {{data.preview.sessionId}} -->
      <span class="ms-3"><b>S·ªë c√¢u h·ªèi:</b> {{data.preview.totalBlocks}}</span>
    </div>

    <div class="d-flex align-items-center gap-3">
      <mat-checkbox [(ngModel)]="selectAll" (change)="toggleSelectAll()">Ch·ªçn t·∫•t c·∫£</mat-checkbox>
      <mat-checkbox [checked]="data.saveCopy" disabled>L∆∞u b·∫£n copy</mat-checkbox>
    </div>
  </div>
</div>

<mat-dialog-content class="pt-0" style="max-height: 65vh; overflow: auto;">
  <mat-card class="mb-3" *ngFor="let s of state; trackBy: trackByIndex">
    <mat-card-content>
      <!-- header -->
      <div class="d-flex justify-content-between align-items-start gap-2">
        <div class="d-flex align-items-center gap-2">
          <mat-checkbox [(ngModel)]="s.include"></mat-checkbox>
          <div class="fw-bold">#{{s.index}}</div>
        </div>

        <div class="d-flex gap-3 flex-wrap" style="min-width:260px;">
          <mat-form-field appearance="outline" style="width:150px;">
            <mat-label>Lo·∫°i</mat-label>
            <mat-select [(ngModel)]="s.questionType">
              <mat-option value="MULTIPLE_CHOICE">Tr·∫Øc nghi·ªám</mat-option>
              <mat-option value="ESSAY">T·ª± lu·∫≠n</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" style="width:110px;">
            <mat-label>Ch∆∞∆°ng</mat-label>
            <mat-select [(ngModel)]="s.chapter">
              <mat-option *ngFor="let c of chapters" [value]="c">{{c}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" style="width:110px;">
            <mat-label>ƒê·ªô kh√≥</mat-label>
            <mat-select [(ngModel)]="s.difficulty">
              <mat-option *ngFor="let d of diffs" [value]="d">{{d}}</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- üîπ Nh√£n per-block -->
          <mat-form-field appearance="outline" style="width:180px;">
            <mat-label>Nh√£n</mat-label>
            <mat-select [(ngModel)]="s.labels" multiple>
              <mat-option *ngFor="let opt of labelOptions" [value]="opt">{{ opt }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <!-- RTE host -->
      <mat-form-field appearance="outline" class="w-100 mt-2">
        <mat-label>N·ªôi dung</mat-label>
        <textarea #rteArea matInput rows="3"></textarea>
      </mat-form-field>

      <!-- MULTIPLE CHOICE -->
      <div *ngIf="s.questionType==='MULTIPLE_CHOICE'" class="mt-1">
        <div class="row g-2">
          <div class="col-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>ƒê√°p √°n A</mat-label>
              <input matInput [(ngModel)]="s.optionA">
            </mat-form-field>
          </div>
          <div class="col-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>ƒê√°p √°n B</mat-label>
              <input matInput [(ngModel)]="s.optionB">
            </mat-form-field>
          </div>
          <div class="col-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>ƒê√°p √°n C</mat-label>
              <input matInput [(ngModel)]="s.optionC">
            </mat-form-field>
          </div>
          <div class="col-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>ƒê√°p √°n D</mat-label>
              <input matInput [(ngModel)]="s.optionD">
            </mat-form-field>
          </div>
        </div>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>ƒê√°p √°n (A/B/C/D ho·∫∑c text)</mat-label>
          <input matInput [(ngModel)]="s.answer">
        </mat-form-field>
      </div>

      <!-- ESSAY -->
      <div *ngIf="s.questionType==='ESSAY'" class="mt-1">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Gi·∫£i th√≠ch / ƒë√°p √°n</mat-label>
          <textarea matInput rows="2" [(ngModel)]="s.answerText"></textarea>
        </mat-form-field>
      </div>

      <!-- Images -->
      <div *ngIf="s.imageIndexes?.length" class="mt-1">
        <div class="small text-muted mb-1">·∫¢nh ƒë√≠nh k√®m:</div>
        <div class="d-flex flex-wrap gap-2">
          <label class="img-check" *ngFor="let idx of s.imageIndexes; let i = index">
            <input type="checkbox" [checked]="true" (change)="onImgToggle(s, idx, $event)">
            <img [src]="imageUrl(idx)" alt="img" />
            <span class="small text-muted">#{{idx+1}}</span>
          </label>
        </div>
      </div>

      <div class="text-danger small mt-1" *ngIf="s.warnings?.length">
        ‚Ä¢ {{ (s.warnings || []).join(' ‚Ä¢ ') }}
      </div>
    </mat-card-content>
  </mat-card>
</mat-dialog-content>

<mat-dialog-actions [align]="'end'">
  <button mat-stroked-button mat-dialog-close [disabled]="loading">ƒê√≥ng</button>
  <button mat-flat-button color="primary" (click)="commit()" [disabled]="loading">
    <mat-icon *ngIf="!loading">publish</mat-icon>
    <mat-icon *ngIf="loading" class="spin">autorenew</mat-icon>
    <span class="ms-1">X√°c nh·∫≠n c√°c m·ª•c ƒë√£ ch·ªçn</span>
  </button>
</mat-dialog-actions>
