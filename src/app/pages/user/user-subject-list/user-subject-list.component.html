<div class="container mt-4 position-relative">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <button class="btn btn-outline-secondary me-3" [routerLink]="['/user-dashboard']" [disabled]="isLoading">
        <i class="bi bi-arrow-left me-1"></i> Quay lại
      </button>
      <h2 class="d-inline-block mb-0">MÔN TÔI DẠY</h2>
    </div>

    <div *ngIf="subjects.length">
      <span class="text-muted">
        Tổng số môn: <strong>{{ subjects.length }}</strong>
      </span>
    </div>
  </div>

  <!-- Search box giống head -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="input-group">
        <span class="input-group-text bg-white border-end-0">
          <i class="bi bi-search"></i>
        </span>
        <input type="text" class="form-control border-start-0" placeholder="Tìm kiếm môn học (tên / mã / giảng viên)…"
          [(ngModel)]="searchText" [disabled]="isLoading" />
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <!-- Empty -->
      <div *ngIf="!isLoading && filteredSubjects.length === 0" class="text-center py-5">
        <i class="bi bi-book text-muted" style="font-size: 3rem;"></i>
        <h4 class="mt-3">Chưa có môn được phân công</h4>
        <p class="text-muted">Bạn sẽ thấy danh sách môn khi được phân công giảng dạy.</p>
      </div>

      <!-- List -->
      <div *ngIf="!isLoading && filteredSubjects.length > 0" class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th style="width: 90px; cursor: pointer;" (click)="sort('id')">
                ID <i class="{{ sortIcons['id'] }} ms-1"></i>
              </th>
              <th style="cursor: pointer;" (click)="sort('name')">
                Tên môn học <i class="{{ sortIcons['name'] }} ms-1"></i>
              </th>
              <th style="width: 220px; cursor: pointer;" (click)="sort('code')">
                Mã môn học <i class="{{ sortIcons['code'] }} ms-1"></i>
              </th>
              <th>Giảng viên khác</th>
              <th class="text-center" style="width: 160px;">
                Hành động
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of filteredSubjects; trackBy: trackById" (click)="openSubject(s)"
              (keydown.enter)="openSubject(s)" tabindex="0" style="cursor:pointer">

              <td>{{ s.id }}</td>
              <td>{{ s.name }}</td>
              <td>{{ s.code }}</td>
              <td>
                <div *ngIf="s.teachers && s.teachers.length > 0; else noTeachers">
                  <span class="badge bg-info me-1" *ngFor="let t of s.teachers">
                    {{ t.lastName }} {{ t.firstName }}
                  </span>
                </div>
                <ng-template #noTeachers>
                  <span class="text-muted">Chưa phân công</span>
                </ng-template>
              </td>

              <!-- NEW: Hành động -->
              <td class="text-center" (click)="$event.stopPropagation()">
                <button class="btn btn-sm btn-outline-secondary" [disabled]="isLoading"
                  (click)="openSettingDialog(s, $event)">
                  <i class="bi bi-gear"></i> Setting
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <app-loading-screen *ngIf="isLoading" [blurBackground]="false"></app-loading-screen>
    </div>
  </div>
</div>